Этот код реализует модуль для работы с субтитрами в ECMAScript (JavaScript) с использованием движка Duktape. Модуль позволяет добавлять провайдеры субтитров, добавлять субтитры в медиаплеер и получать список доступных языков субтитров. Давайте разберем его подробнее.

---

## Основные функции модуля `subtitle`

### `addProvider(id, title, callback)`
Добавляет нового провайдера субтитров.

**Параметры:**
- `id` (строка) — Уникальный идентификатор провайдера.
- `title` (строка) — Название провайдера.
- `callback` (функция) — Функция, которая будет вызываться при поиске субтитров.

**Возвращает:**
Объект провайдера субтитров.

**Пример:**
```javascript
var provider = subtitle.addProvider("my_provider", "My Provider", function(proproot, metadata, score, autosel) {
    // Логика поиска субтитров
});
```

---

### `addItem(proproot, url, title, language, format, source, score, autosel)`
Добавляет субтитры в медиаплеер.

**Параметры:**
- `proproot` (объект) — Корневой объект свойства (prop), связанный с медиафайлом.
- `url` (строка) — URL субтитров.
- `title` (строка) — Название субтитров.
- `language` (строка) — Язык субтитров.
- `format` (строка) — Формат субтитров (например, "srt").
- `source` (строка) — Источник субтитров.
- `score` (число) — Оценка субтитров (чем выше, тем лучше).
- `autosel` (логическое значение) — Автоматически выбирать субтитры, если `true`.

**Пример:**
```javascript
subtitle.addItem(proproot, "http://example.com/subtitles.srt", "English Subtitles", "en", "srt", "example.com", 100, true);
```

---

### `getLanguages()`
Возвращает массив доступных языков субтитров.

**Возвращает:**
Массив строк с кодами языков.

**Пример:**
```javascript
var languages = subtitle.getLanguages();
console.log(languages); // ["en", "sv", "ru"]
```

---

## Внутренняя реализация

### Структура `es_sp_t`
Эта структура представляет провайдера субтитров и содержит:
- `super` — Базовый объект ресурса.
- `id` — Уникальный идентификатор провайдера.
- `sp` — Объект провайдера субтитров.
- `title` — Название провайдера.

---

### Функция `esp_query`
Эта функция вызывается при поиске субтитров. Она:
1. Получает метаданные медиафайла (например, название, год, эпизод).
2. Вызывает JavaScript-функцию, переданную в `addProvider`.
3. Передает результаты поиска в медиаплеер.

---

### Функция `es_subtitleprovideradd`
Создает и регистрирует нового провайдера субтитров. Она:
1. Создает объект `es_sp_t`.
2. Регистрирует провайдера в системе.
3. Возвращает объект провайдера в JavaScript.

---

### Функция `es_subtitleadditem`
Добавляет субтитры в медиаплеер. Она:
1. Получает параметры субтитров (URL, язык, формат и т.д.).
2. Вызывает функцию `mp_add_track` для добавления субтитров.

---

### Функция `es_getsubtitlelanguages`
Возвращает массив доступных языков субтитров. Она использует функцию `i18n_subtitle_lang` для получения языков.

---

## Пример использования модуля

### Добавление провайдера субтитров
```javascript
var provider = subtitle.addProvider("my_provider", "My Provider", function(proproot, metadata, score, autosel) {
    console.log("Searching subtitles for:", metadata.title);

    // Добавляем субтитры
    subtitle.addItem(proproot, "http://example.com/subtitles.srt", "English Subtitles", "en", "srt", "example.com", 100, true);
});
```

### Получение списка языков
```javascript
var languages = subtitle.getLanguages();
console.log("Available languages:", languages);
```

---

## Примечания
- Модуль интегрируется с системой медиаплеера и поддерживает автоматический выбор субтитров.
- Провайдеры субтитров могут быть реализованы на стороне JavaScript, что делает модуль гибким и расширяемым.
- Для работы с субтитрами используются стандартные форматы, такие как SRT.

---

Этот модуль полезен для создания плагинов субтитров, которые могут интегрироваться с медиаплеером и предоставлять субтитры из различных источников.
