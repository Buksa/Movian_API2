# Документация модуля `prop`

Модуль `prop` предоставляет функции для работы с **свойствами** (properties) в системе. Свойства могут быть строками, числами, булевыми значениями, директориями (содержащими другие свойства) и т.д. Этот модуль позволяет управлять структурой свойств, подписываться на изменения и взаимодействовать с UI.

---

## Основные функции

### 1. **Создание и управление свойствами**
| Функция                     | Описание                                                                 |
|-----------------------------|-------------------------------------------------------------------------|
| `create(name)`              | Создает новое свойство с указанным именем.                              |
| `getValue()`                | Возвращает значение свойства (строка, число, null и т.д.).              |
| `set(name, value)`          | Устанавливает значение свойства. Поддерживает строки, числа, булевы.    |
| `setRichStr(name, text)`    | Устанавливает "богатый" текст (с форматированием).                      |
| `destroy()`                 | Уничтожает свойство.                                                    |

**Пример:**
```javascript
var prop = require('native/prop');

// Создание свойства
var p = prop.create('myProp');
prop.set(p, 'value', 42); // Установка числа
var value = prop.getValue(p); // 42
prop.destroy(p); // Уничтожение
```

---

### 2. **Работа с дочерними свойствами**
| Функция                     | Описание                                                                 |
|-----------------------------|-------------------------------------------------------------------------|
| `getChild(name/index)`      | Возвращает дочернее свойство по имени или индексу.                      |
| `enumerate()`               | Возвращает массив имен дочерних свойств.                                |
| `has(name)`                 | Проверяет существование дочернего свойства.                             |
| `deleteChild(name)`         | Удаляет дочернее свойство.                                              |
| `deleteChilds()`            | Удаляет все дочерние свойства.                                          |

**Пример:**
```javascript
var dir = prop.create('dir');
prop.set(dir, 'child1', 'Hello');
prop.set(dir, 'child2', 123);

var children = prop.enumerate(dir); // ['child1', 'child2']
var child1 = prop.getChild(dir, 'child1');
prop.deleteChild(dir, 'child1');
```

---

### 3. **Подписка на изменения**
| Функция                     | Описание                                                                 |
|-----------------------------|-------------------------------------------------------------------------|
| `subscribe(options)`        | Подписывается на изменения свойства. Возвращает объект подписки.        |
| `haveMore(yes)`             | Указывает, есть ли дополнительные дочерние свойства для загрузки.       |

**Пример:**
```javascript
var sub = prop.subscribe(myProp, {
  autoDestroy: true,
  callback: function(event, data) {
    console.log('Событие:', event, 'Данные:', data);
  }
});
prop.haveMore(myProp, true); // Уведомление о наличии доп. данных
```

---

### 4. **Связывание и события**
| Функция                     | Описание                                                                 |
|-----------------------------|-------------------------------------------------------------------------|
| `link(parent)`              | Связывает свойство с родителем.                                         |
| `unlink()`                  | Разрывает связь с родителем.                                            |
| `sendEvent(type, data)`     | Отправляет событие (например, открытие URL).                           |

**Пример:**
```javascript
var parent = prop.create('parent');
var child = prop.create('child');
prop.link(child, parent); // Связывание

// Отправка события
prop.sendEvent(child, 'openurl', {
  url: 'https://example.com',
  view: 'default'
});
```

---

### 5. **Фильтрация свойств**
| Функция                     | Описание                                                                 |
|-----------------------------|-------------------------------------------------------------------------|
| `nodeFilterCreate(root)`    | Создает фильтр для свойств.                                             |
| `nodeFilterAddPred(...)`    | Добавляет условие фильтра (равенство, сравнение).                       |
| `nodeFilterDelPred(id)`     | Удаляет условие фильтра.                                                |

**Пример:**
```javascript
var filter = prop.nodeFilterCreate(rootProp, baseProp);
var predId = prop.nodeFilterAddPred(filter, 'path', 'eq', 'value', 'include');
prop.nodeFilterDelPred(filter, predId);
```

---

## Пример использования

**Создание дерева свойств и подписка на изменения:**
```javascript
var prop = require('native/prop');

// Создание корневого свойства
var root = prop.create('root');

// Добавление дочерних свойств
prop.set(root, 'title', 'Медиатека');
prop.set(root, 'items', []);

// Подписка на изменения
var sub = prop.subscribe(root, {
  callback: function(event, data) {
    if (event === 'addchild') {
      console.log('Добавлен дочерний элемент:', data);
    }
  }
});

// Отправка события
prop.sendEvent(root, 'redirect', '/new/path');
```

---

## Примечания

- **Свойства-директории** (`PROP_DIR`) содержат дочерние свойства и используются для построения древовидных структур.
- **Подписки** автоматически удаляются при уничтожении контекста ECMAScript.
- Используйте `prop.isZombie()`, чтобы проверить, было ли свойство удалено.
- Для работы с асинхронными данными используйте `haveMore()` и `subscribe()`.
