# Документация модуля `hook`

Модуль `hook` предоставляет механизм для регистрации и вызова хуков (hook) в ECMAScript (JavaScript) среде. Хуки позволяют подписываться на определенные события и выполнять пользовательские функции при их наступлении. Ниже приведено подробное описание функций и примеры их использования.

---

## Функции

### 1. `register(type, callback)`
Регистрирует хук для определенного типа события.

- **Аргументы**:
  - `type` (строка): Тип события, на которое подписывается хук.
  - `callback` (функция): Функция, которая будет вызвана при наступлении события.
- **Возвращает**: Объект хука, который можно использовать для управления подпиской.
- **Пример**:
  ```javascript
  var hook = hook.register("myEvent", function(arg1, arg2) {
    console.log("Хук вызван с аргументами:", arg1, arg2);
  });
  ```

---

### 2. `es_hook_invoke(type, push_args, opaque)`
Вызывает все зарегистрированные хуки для указанного типа события.

- **Аргументы**:
  - `type` (строка): Тип события, для которого вызываются хуки.
  - `push_args` (функция): Функция, которая добавляет аргументы в стек Duktape.
  - `opaque` (указатель): Пользовательские данные, передаваемые в `push_args`.
- **Возвращает**: `0` в случае успеха.
- **Пример использования в C**:
  ```c
  int push_args(duk_context *ctx, void *opaque) {
    duk_push_string(ctx, "Hello");
    duk_push_int(ctx, 42);
    return 2; // Количество аргументов
  }

  es_hook_invoke("myEvent", push_args, NULL);
  ```

---

## Пример использования

Пример использования модуля `hook` в среде JavaScript (ES5.1):

### Регистрация хука
```javascript
var hook = require('native/hook');

// Регистрация хука для события "myEvent"
hook.register("myEvent", function(arg1, arg2) {
  console.log("Хук вызван с аргументами:", arg1, arg2);
});
```

### Вызов хука
Пример вызова хука из C-кода:
```c
int push_args(duk_context *ctx, void *opaque) {
  duk_push_string(ctx, "Hello");
  duk_push_int(ctx, 42);
  return 2; // Количество аргументов
}

es_hook_invoke("myEvent", push_args, NULL);
```

### Результат
При вызове хука из C-кода, зарегистрированная функция в JavaScript будет выполнена с переданными аргументами:
```
Хук вызван с аргументами: Hello 42
```

---

## Примечания

- Хуки позволяют гибко связывать C-код и JavaScript, что полезно для обработки событий и интеграции с внешними системами.
- Каждый хук связан с определенным типом события, что позволяет легко управлять подписками.
- Хуки автоматически удаляются при уничтожении контекста ECMAScript, что предотвращает утечки памяти.

Этот модуль предоставляет мощный механизм для обработки событий и интеграции между C и JavaScript, что делает его подходящим для задач, таких как обработка событий, уведомления и взаимодействие с внешними системами.
